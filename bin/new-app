#!/bin/sh
dir=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
app="$dir/.."
template=$dir/../vendor/Dev-Lucid/Lucid/template

echo "Making directories"
mkdir $app/database;
mkdir $app/database/migrations;
mkdir $app/database/build;
mkdir $app/database/models;
mkdir $app/config;
mkdir $app/cache;
mkdir $app/dictionaries;
mkdir $app/app;
mkdir $app/app/controllers;
mkdir $app/app/views;
mkdir $app/app/media;
mkdir $app/app/media/js;
mkdir $app/app/media/images;
mkdir $app/app/media/less;
mkdir $app/app/media/less/fonts;

echo "Coping app files"
cp $template/config/*.php $app/config/
cp $template/config/*.yml $app/config/
cp $template/app/*.php $app/app/
cp $template/database/build/* $app/database/build/
cp $template/database/models/* $app/database/models/
cp $template/app/views/*.php $app/app/views/
cp $template/app/controllers/*.php $app/app/controllers/


cp $template/app/media/js/compile.php $app/app/media/js/;
cp $template/app/media/js/customizations.js $app/app/media/js/;
cp $template/app/media/less/compile.php $app/app/media/less/;
cp $template/app/media/less/customizations.less $app/app/media/less/;


echo "Installing libraries"
cp $template/composer.json $app
cd $app;
rm composer.lock
composer install

echo "installing bootstrap fonts"
cp $app/vendor/twbs/bootstrap/fonts/* $app/app/media/less/fonts/;


echo "Retrieving recommended jquery version (1.11.1)"
curl "https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" > jquery.js
mv jquery.js $app/app/media/js/jquery.js;

echo "Building basic database"
cd $app/database/;
sqlite3 development.sqlite ".read build/sqlite.regions.sql"
sqlite3 development.sqlite ".read build/sqlite.main.sql"
sqlite3 development.sqlite ".read build/sqlite.views.sql"


echo "adding ignores, touching scripts/empty.txt"
touch $app/scripts/empty.txt;
cp $template/gitignore $app/.gitignore;

echo "-----------------------"
echo "App complete. to run this app, scripts/launch $1;"
